{{ define "emails" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email List</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f0f0f0; }
        tr:nth-child(even) { background: #fafafa; }
        .highlight { background-color: yellow; }
        form { margin-bottom: 1em; }
        .pagination { margin: 1em 0; }
        .pagination a { margin: 0 5px; text-decoration: none; }
    </style>
</head>
<body>
    <h1>Email Records</h1>

    <!-- Search, Limit, and Column Selection form -->
    <form method="get" action="">
        <input type="text" name="search" placeholder="Search" value="{{ .Search }}">
        <select name="limit">
            {{ $limits := slice 10 25 50 100 }}
            {{ range $limits }}
                <option value="{{ . }}" {{ if eq (printf "%d" $.Limit) (printf "%d" .) }}selected{{ end }}>{{ . }}</option>
            {{ end }}
        </select>

    <fieldset>
        <legend>Search in columns:</legend>
        {{ $columns := sliceStr "From" "To" "Date" "Subject" "Reason" "Body" "RegistrarId" "Sent" "Status" }}
        {{ range $col := $columns }}
        <label>
            <input type="checkbox" name="columns" value="{{ $col }}"
                {{ if (inSlice $col $.SelectedColumns) }}checked{{ end }}>
            {{ $col }}
        </label>
        {{ end }}
    </fieldset>


        <button type="submit">Search</button>
    </form>

    <!-- Pagination arrows -->
    <div class="pagination">
        {{ $prev := subtract $.Offset $.Limit }}
        {{ $columnsParam := join $.SelectedColumns "&columns=" }}
        {{ if ge $prev 0 }}
            <a href="?search={{ .Search }}&limit={{ printf "%d" .Limit }}&offset={{ printf "%d" $prev }}{{ if $.SelectedColumns }}&columns={{ $columnsParam }}{{ end }}">&#8592; Prev</a>
        {{ end }}
        <span>Page {{ add (div $.Offset $.Limit) 1 }}</span>
        <a href="?search={{ .Search }}&limit={{ printf "%d" .Limit }}&offset={{ printf "%d" (add $.Offset $.Limit) }}{{ if $.SelectedColumns }}&columns={{ $columnsParam }}{{ end }}">Next &#8594;</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>From</th>
                <th>To</th>
                <th>Date</th>
                <th>Subject</th>
                <th>Reason</th>
                <th>Body</th>
                <th>Registrar ID</th>
                <th>Sent</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
        {{ range .Emails }}
            <tr>
                <td>{{ .ID }}</td>
                <td>{{ if (inSlice "From" $.SelectedColumns) }}{{ highlight .From $.Search }}{{ else }}{{ .From }}{{ end }}</td>
                <td>{{ if (inSlice "To" $.SelectedColumns) }}{{ highlight .To $.Search }}{{ else }}{{ .To }}{{ end }}</td>
                <td>{{ if (inSlice "Date" $.SelectedColumns) }}{{ formatDate .Date }}{{ else }}{{ formatDate .Date }}{{ end }}</td>
                <td>{{ if (inSlice "Subject" $.SelectedColumns) }}{{ highlight .Subject $.Search }}{{ else }}{{ .Subject }}{{ end }}</td>
                <td>{{ if (inSlice "Reason" $.SelectedColumns) }}{{ highlight .Reason $.Search }}{{ else }}{{ .Reason }}{{ end }}</td>
                <td>{{ if (inSlice "Body" $.SelectedColumns) }}{{ highlight .Body $.Search }}{{ else }}{{ .Body }}{{ end }}</td>
                <td>{{ if (inSlice "RegistrarId" $.SelectedColumns) }}{{ highlight .RegistrarId $.Search }}{{ else }}{{ .RegistrarId }}{{ end }}</td>
                <td>{{ if (inSlice "Sent" $.SelectedColumns) }}{{ highlight .Sent $.Search }}{{ else }}{{ .Sent }}{{ end }}</td>
                <td>{{ if (inSlice "Status" $.SelectedColumns) }}{{ highlight .Status $.Search }}{{ else }}{{ .Status }}{{ end }}</td>
            </tr>
        {{ else }}
            <tr>
                <td colspan="10">No emails found.</td>
            </tr>
        {{ end }}
        </tbody>
    </table>
</body>
</html>
{{ end }}
